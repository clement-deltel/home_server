- name: Initialize persistence directories and files
  tags: docker
  block:

  #--- Traefik
  - name: Create Traefik persistence directory
    file:
      path: "{{ services }}/traefik/persistence"
      state: directory
      owner: docker
      group: docker
      mode: 0744
  - name: Copy Traefik configuration file
    copy:
      src: "{{ services }}/traefik/config/traefik.toml"
      dest: "{{ services }}/traefik/persistence/traefik.toml"
      owner: docker
      group: docker
      mode: 0644

  #--- Bitwarden
  - name: Create Bitwarden persistence directories
    file:
      path: "{{ item }}"
      state: directory
      owner: docker
      group: docker
      mode: 0744
    loop:
      - "{{ services }}/bitwarden/persistence"
      - "{{ services }}/bitwarden/db-persistence"

  #--- Nextcloud
  - name: Create Nextcloud persistence directories
    file:
      path: "{{ item }}"
      state: directory
      owner: docker
      group: docker
      mode: 0744
    loop:
      - "{{ services }}/nextcloud/persistence"
      - "{{ services }}/nextcloud/db-persistence"
      - "{{ services }}/nextcloud/web-persistence"

  #--- Pihole
  - name: Create Pihole log file
    file:
      path: "{{ services }}/pihole/pihole.log"
      state: touch
      owner: docker
      group: docker
      mode: 0744
  - name: Create Pihole directories
    file:
      path: "{{ item }}"
      state: directory
      owner: docker
      group: docker
      mode: 0744
    loop:
      - "{{ services }}/pihole/etc-pihole"
      - "{{ services }}/pihole/etc-dnsmasqd"

  #--- Jellyfin
  - name: Create Jellyfin persistence directories
    file:
      path: "{{ item }}"
      state: directory
      owner: docker
      group: docker
      mode: 0744
    loop:
     - "{{ services }}/jellyfin/persistence"
     - "{{ services }}/jellyfin/persistence/library"
     - "{{ services }}/jellyfin/persistence/tvshows"
     - "{{ services }}/jellyfin/persistence/movies"
